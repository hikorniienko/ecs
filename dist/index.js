!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e(require("pixi.js"),require("@tweenjs/tween.js")):"function"==typeof define&&define.amd?define("ecs",["pixi.js","@tweenjs/tween.js"],e):"object"==typeof exports?exports.ecs=e(require("pixi.js"),require("@tweenjs/tween.js")):t.ecs=e(t["pixi.js"],t["@tweenjs/tween.js"])}(this,(t,e)=>(()=>{"use strict";var s={387:function(t){t.exports=e},327:function(e){e.exports=t}},n={};function i(t){var e=n[t];if(void 0!==e)return e.exports;var o=n[t]={exports:{}};return s[t](o,o.exports,i),o.exports}i.d=function(t,e){for(var s in e)i.o(e,s)&&!i.o(t,s)&&Object.defineProperty(t,s,{enumerable:!0,get:e[s]})},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})};var o={};function r(t,e,s){return e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}i.r(o),i.d(o,{GraphicsComponent:()=>l,ContainerComponent:()=>p,TweenComponent:()=>m,ECS:()=>h,Entity:()=>a,System:()=>c,RenderSystem:()=>v,EventManager:()=>f,ParentComponent:()=>y});var d=i("327");class a{addComponent(t){this._components.set(t.constructor.name,t)}getComponent(t){return this._components.get(t)}destroy(){this._destroyed=!0,this._onDestroy()}isDestroyed(){return this._destroyed}constructor(t,e){r(this,"id",void 0),r(this,"_onDestroy",void 0),r(this,"_destroyed",void 0),r(this,"_components",void 0),this.id=t,this._onDestroy=e,this._destroyed=!1,this._components=new Map}}class h{async execute(){let t=this.settings.root;await this.app.init({width:t.clientWidth,height:t.clientHeight,resizeTo:t}),t.appendChild(this.app.canvas),this.app.ticker.add(()=>{this.systems.forEach(t=>{t.update(this.entities),t.isDestroyed()&&this.systems.delete(t.constructor.name)}),this._destroyedEntityIds.forEach(t=>{this.entities.delete(t)}),this._destroyedEntityIds=[]})}setSettings(t){this.settings={...this.settings,...t}}createEntity(){this._nextEntityId+=1;let t=`entity-${this._nextEntityId}`,e=new a(t,()=>{this._destroyedEntityIds.push(t)});return this.entities.set(t,e),e}destroyEntity(t){var e;null===(e=this.entities.get(t))||void 0===e||e.destroy()}addSystem(t){this.systems.set(t.constructor.name,t)}removeSystem(t){var e;null===(e=this.systems.get(t))||void 0===e||e.destroy()}constructor(t){r(this,"app",new d.Application),r(this,"entities",new Map),r(this,"systems",new Map),r(this,"settings",{root:document.body}),r(this,"_nextEntityId",0),r(this,"_destroyedEntityIds",[]),this.setSettings(t),this.execute()}}class c{update(t){}destroy(){this._destroyed=!0}isDestroyed(){return this._destroyed}constructor(t){r(this,"ecs",void 0),r(this,"_destroyed",void 0),this.ecs=t,this._destroyed=!1}}class p extends d.Container{}class l extends d.Graphics{}class y{constructor(t){r(this,"parentEntityId",void 0),this.parentEntityId=t}}var u=i("387");class m{constructor(){r(this,"tweens",new u.Group)}}class v extends c{getChildrenLabels(t){let e=[];return t.children.forEach(t=>{e.push(t.label),e.push(...this.getChildrenLabels(t))}),e}update(t){t.forEach(e=>{let s=e.getComponent("ContainerComponent"),n=e.getComponent("GraphicsComponent"),i=e.getComponent("ParentComponent"),o=e.getComponent("TweenComponent");if(s&&!s.label&&(s.label=e.id),s&&e.isDestroyed()){let t=this.getChildrenLabels(s);s.parent&&s.parent.removeChild(s),s.destroy({children:!0,context:!0,texture:!0,style:!0}),this.ecs.destroyEntity(s.label),t.forEach(t=>{this.ecs.destroyEntity(t)});return}if(s&&!s.parent){var r;let e=i&&i.parentEntityId&&(null===(r=t.get(i.parentEntityId))||void 0===r?void 0:r.getComponent("ContainerComponent"));e?e.addChild(s):this.ecs.app.stage.addChild(s)}s&&n&&!n.parent&&s.addChild(n),e.isDestroyed()&&o&&o.tweens.removeAll(),o&&o.tweens.update()})}}class f{on(t,e){let s=arguments.length>2&&void 0!==arguments[2]&&arguments[2];!this._events[t]&&(this._events[t]=new Set),this._events[t].add({listener:e,once:s})}off(t,e){let s=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._events[t]&&this._events[t].delete({listener:e,once:s})}emit(t,e){this._events[t]&&this._events[t].forEach(s=>{s.listener(e),s.once&&this._events[t].delete(s)})}async take(t){return new Promise(e=>{this.on(t,t=>{e(t)},!0)})}constructor(){r(this,"_events",{}),r(this,"list",{})}}return o})());